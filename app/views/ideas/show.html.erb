<p style="color: green"><%= notice %></p>

<div id="<%= dom_id @idea %>" class="d-flex gap-3 py-3">
  <div class="d-flex flex-column gap-2 w-100">
    <h1><%= @idea.name %></h1>
    <p><%= @idea.description %></p>
    <% if @idea.date.present? || @idea.subject.present? || @idea.submission_method.present? %>
      <p>
        <% if @idea.date.present? %>
          <strong>提出日:</strong> <%= @idea.date %><br>
        <% end %>
        <% if @idea.subject.present? %>
          <strong>科目:</strong> <%= @idea.subject %><br>
        <% end %>
        <% if @idea.submission_method.present? %>
          <strong>提出方法:</strong>
          <% submission = @idea.submission_method %>
          <% if submission =~ /\Ahttps?:\/\//i %>
            <%= link_to submission, submission, target: "_blank", rel: "noopener" %>
          <% else %>
            <%= submission %>
          <% end %>
        <% end %>
               <strong>提出状態:</strong> <span id="submission-status-<%= @idea.id %>"><%= @idea.submission == 1 ? "提出済み ✓" : "未提出" %></span><br>
        <% if @idea.submission == 1 %>
          <button class="btn btn-lg btn-warning idea-submission-btn" data-idea-id="<%= @idea.id %>" data-action="cancel">
            提出を取り消す
          </button>
        <% else %>
          <button class="btn btn-lg btn-success idea-submission-btn" data-idea-id="<%= @idea.id %>" data-action="submit">
            提出完了
          </button>
        <% end %>
      </p>
    <% end %>
    <small class="opacity-50 text-nowrap">Last updated <%= time_ago_in_words @idea.updated_at %></small>
  </div>
  <%= image_tag(@idea.picture_url, width: 150, height: 150, class: "img-thumbnail flex-shrink-0") if @idea.picture? %>
</div>

<div class="d-flex gap-3 py-3">
  <%= link_to "タスクを追加", edit_idea_path(@idea), class: "btn btn-primary" %>
  <%= link_to "タスク一覧にもどる", ideas_path, class: "btn btn-outline-secondary" %>
  <%= button_to "タスクを削除", @idea, method: :delete, class: "btn btn-danger", form: { data: { turbo_confirm: "Are you sure?" } } %>
</div>

<h2>Comments</h2>
<% if @comments.any? %>
  <% @comments.each do |comment| %>
    <div>
      <p><strong><%= comment.user_name %></strong></p>
      <p><%= comment.body %></p>
      <%= button_to "メモを削除", idea_comment_path(@idea, comment), method: :delete, class: "btn btn-danger", form: { data: { turbo_confirm: "Are you sure?" } } %>
    </div>
  <% end %>
<% else %>
  <p>No comments found.</p>
<% end %>

<h2>Add a new comment</h2>
<%= render partial: "comments/form", locals: { idea: @idea } %>