<div id="<%= dom_id idea %>" class="list-group-item list-group-item-action d-flex gap-3 py-3">
  <div class="d-flex flex-column gap-2 w-100">
    <div class="d-flex justify-content-between align-items-center">
      <h2><%= link_to idea.name, idea_path(idea) %></h2>
      <span class="badge <%= case idea.status
        when 'not_started' then 'bg-secondary'
        when 'in_progress' then 'bg-primary'
        when 'completed' then 'bg-success'
      end %>">
        <%= case idea.status
          when 'not_started' then '未着手'
          when 'in_progress' then '進行中'
          when 'completed' then '完了済み'
        end %>
      </span>
    </div>
    <p><%= idea.description %></p>
    <% if idea.date.present? || idea.subject.present? || idea.submission_method.present? %>
      <p>
        <% if idea.date.present? %>
          <strong>提出日:</strong> <%= idea.date %><br>
        <% end %>
        <% if idea.subject.present? %>
          <strong>科目:</strong> <%= idea.subject %><br>
        <% end %>
        <% if idea.submission_method.present? %>
          <strong>提出方法:</strong>
          <% submission = idea.submission_method %>
          <% if submission =~ /\Ahttps?:\/\//i %>
            <%= link_to submission, submission, target: "_blank", rel: "noopener" %>
          <% else %>
            <%= submission %>
          <% end %>
        <% end %>
        <strong>提出状態:</strong> <span id="submission-status-<%= idea.id %>"><%= idea.submission == 1 ? "提出済み ✓" : "未提出" %></span>
        <% if idea.submission == 1 %>
          <button class="btn btn-sm btn-warning idea-submission-btn" data-idea-id="<%= idea.id %>" data-action="cancel">
            提出を取り消す
          </button>
        <% else %>
          <button class="btn btn-sm btn-success idea-submission-btn" data-idea-id="<%= idea.id %>" data-action="submit">
            提出完了
          </button>
        <% end %>
        <% if idea.date.present? %>
          <br>
          <% remaining_days = (idea.date - Date.today).to_i %>
          <small class="<%= remaining_days < 0 ? 'text-danger' : remaining_days <= 3 ? 'text-warning' : 'text-muted' %>">
            <strong>残り日数:</strong>
            <% if remaining_days < 0 %>
              期限切れ（<%= remaining_days.abs %>日前）
            <% elsif remaining_days == 0 %>
              本日が提出期限
            <% else %>
              あと<%= remaining_days %>日
            <% end %>
          </small>
        <% end %>

      </p>
    <% end %>
    <small class="opacity-50 text-nowrap">Last updated <%= time_ago_in_words idea.updated_at %></small>
  </div>
  <%= image_tag(idea.picture_url(:thumb), width: 150, height: 150, class: "img-thumbnail flex-shrink-0") if idea.picture? %>
</div>
